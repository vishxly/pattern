import { ComponentGroup } from "@/lib/docs/types";
import GalleryDemo from "../components/gallery";

export const galleryRegistry: ComponentGroup = {
  "name": "galleryRegistry",
  "title": "Gallery",
  "description": "A React component that provides gallery functionality.",
  "category": "components",
  "components": [
    "GalleryDemo"
  ],
  "installation": {
    "cliCommand": "npx shadcn@latest add \"https://zeroui.vercel.app/r/gallery\"",
    "dependencies": [
      "@use-gesture/react",
      "@react-spring/web",
      "styled-components"
    ],
    "componentPath": "components/ui/gallery.tsx",
    "utilsCode": "import { ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}"
  },
  "props": [],
  "variants": {
    "basic": {
      "title": "Basic Gallery",
      "description": "A basic implementation of the Gallery component.",
      "component": GalleryDemo,
      "image": "/images/components/gallery-basic.png",
      "fallbackImage": "/placeholder.svg?height=300&width=400&text=Basic%20Gallery",
      "code": "\"use client\";\nimport { Gallery } from \"../ui/gallery\";\n\nexport const GalleryDemo = () => {\n  return (\n    <div className=\"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-900 p-12 rounded-xl\">\n      <Gallery>\n        Demo Content\n      </Gallery>\n    </div>\n  );\n};\n\nexport default GalleryDemo;",
      "manualCode": "import React, {\r\n    useEffect,\r\n    useRef,\r\n    useCallback,\r\n    useMemo,\r\n    useState,\r\n  } from \"react\";\r\n  import { useGesture } from \"@use-gesture/react\";\r\n  import { a, useSpring, config } from \"@react-spring/web\";\r\n  import styled, { createGlobalStyle, ThemeProvider, DefaultTheme } from \"styled-components\";\r\n  \r\n  declare module \"styled-components\" {\r\n    export interface DefaultTheme {\r\n      background: string;\r\n      itemBorder: string;\r\n      itemBorderRadius: string;\r\n      textColor: string;\r\n    }\r\n  }\r\n  \r\n  // --- Types and Default Data ---\r\n  \r\n  type ImageItem = string | { src: string; alt?: string };\r\n  \r\n  type LayoutType = \"sphere\" | \"helix\";\r\n  \r\n  type DomeGalleryProps = {\r\n    images?: ImageItem[];\r\n    layout?: LayoutType;\r\n    radius?: number;\r\n    itemCount?: number;\r\n    rotationSpeed?: number;\r\n    dragSensitivity?: number;\r\n    theme?: any;\r\n  };\r\n  \r\n  type ItemDef = {\r\n    src: string;\r\n    alt: string;\r\n    transform: string;\r\n  };\r\n  \r\n  const DEFAULT_IMAGES: ImageItem[] = [\r\n    \"https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1483728642387-6c351bEC6ece?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1470770841072-f978cf4d019e?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1510784722466-f2aa9c52fff6?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1484589065579-248a0714b6af?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n    \"https://images.unsplash.com/photo-1523712999610-f77d3ce699bb?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjEyMDd9\",\r\n  ];\r\n  \r\n  const defaultTheme = {\r\n    background: \"#1a1a1a\",\r\n    itemBorder: \"2px solid white\",\r\n    itemBorderRadius: \"8px\",\r\n    textColor: \"white\",\r\n  };\r\n  \r\n  // --- Styled Components ---\r\n  \r\n  const GlobalStyle = createGlobalStyle`\r\n    body {\r\n      overscroll-behavior-y: contain;\r\n    }\r\n  `;\r\n  \r\n  const Root = styled.div`\r\n    width: 100%;\r\n    height: 100%;\r\n    background: ${(props) => props.theme.background};\r\n    overflow: hidden;\r\n    cursor: grab;\r\n    position: relative;\r\n    &:active {\r\n      cursor: grabbing;\r\n    }\r\n  `;\r\n  \r\n  const Scene = styled(a.div)`\r\n    width: 100%;\r\n    height: 100%;\r\n    position: relative;\r\n    transform-style: preserve-3d;\r\n    perspective: 1000px;\r\n    will-change: transform;\r\n  `;\r\n  \r\n  const Item = styled(a.div)`\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    width: 200px; /* Example size, can be made configurable */\r\n    height: 200px; /* Example size, can be made configurable */\r\n    margin-top: -100px;\r\n    margin-left: -100px;\r\n    transform-style: preserve-3d;\r\n    backface-visibility: hidden;\r\n    will-change: transform, opacity;\r\n  \r\n    img {\r\n      width: 100%;\r\n      height: 100%;\r\n      object-fit: cover;\r\n      border: ${(props) => props.theme.itemBorder};\r\n      border-radius: ${(props) => props.theme.itemBorderRadius};\r\n      pointer-events: none; /* Prevents image dragging */\r\n    }\r\n  `;\r\n  \r\n  // --- Utility Functions ---\r\n  \r\n  const generateSphericalLayout = (count: number, radius: number): ItemDef[] => {\r\n    const items = [];\r\n    const phi = Math.PI * (3 - Math.sqrt(5)); // Golden angle in radians\r\n  \r\n    for (let i = 0; i < count; i++) {\r\n      const y = 1 - (i / (count - 1)) * 2; // y goes from 1 to -1\r\n      const radiusAtY = Math.sqrt(1 - y * y);\r\n      const theta = phi * i;\r\n  \r\n      const x = Math.cos(theta) * radiusAtY;\r\n      const z = Math.sin(theta) * radiusAtY;\r\n  \r\n      const transform = `translateX(-50%) translateY(-50%) translate3d(${\r\n        x * radius\r\n      }px, ${y * radius}px, ${z * radius}px)`;\r\n      items.push({ transform, src: \"\", alt: \"\" }); // Placeholder src/alt\r\n    }\r\n    return items;\r\n  };\r\n  \r\n  const generateHelicalLayout = (count: number, radius: number): ItemDef[] => {\r\n    const items = [];\r\n    for (let i = 0; i < count; i++) {\r\n      const angle = 0.5 * i;\r\n      const x = radius * Math.cos(angle);\r\n      const z = radius * Math.sin(angle);\r\n      const y = -i * 20; // Adjust vertical spacing\r\n  \r\n      const transform = `translateX(-50%) translateY(-50%) translate3d(${x}px, ${y}px, ${z}px) rotateY(${\r\n        -angle\r\n      }rad)`;\r\n      items.push({ transform, src: \"\", alt: \"\" }); // Placeholder src/alt\r\n    }\r\n    return items;\r\n  };\r\n  \r\n  // --- The Component ---\r\n  \r\n  export const DomeGallery: React.FC<DomeGalleryProps> = ({\r\n    images = DEFAULT_IMAGES,\r\n    layout = \"sphere\",\r\n    radius = 500,\r\n    itemCount,\r\n    rotationSpeed = 0.001,\r\n    dragSensitivity = 1,\r\n    theme = defaultTheme,\r\n  }) => {\r\n    const actualItemCount = itemCount || images.length;\r\n    const normalizedImages = useMemo(\r\n      () =>\r\n        Array.from({ length: actualItemCount }, (_, i) => {\r\n          const img = images[i % images.length];\r\n          return typeof img === \"string\" ? { src: img, alt: \"\" } : img;\r\n        }),\r\n      [images, actualItemCount]\r\n    );\r\n  \r\n    const items = useMemo(() => {\r\n      let generatedLayout;\r\n      if (layout === \"helix\") {\r\n        generatedLayout = generateHelicalLayout(actualItemCount, radius);\r\n      } else {\r\n        generatedLayout = generateSphericalLayout(actualItemCount, radius);\r\n      }\r\n  \r\n      return generatedLayout.map((item, i) => ({\r\n        ...item,\r\n        src: normalizedImages[i].src,\r\n        alt: normalizedImages[i].alt || `Gallery image ${i + 1}`,\r\n      }));\r\n    }, [layout, actualItemCount, radius, normalizedImages]);\r\n  \r\n    const [{ rotateX, rotateY }, api] = useSpring(() => ({\r\n      rotateX: 0,\r\n      rotateY: 0,\r\n      config: config.molasses,\r\n    }));\r\n  \r\n    const rotationRef = useRef({ x: 0, y: 0 });\r\n  \r\n    useEffect(() => {\r\n      let animationFrameId: number;\r\n  \r\n      const animate = () => {\r\n        rotationRef.current.y += rotationSpeed;\r\n        api.set({\r\n          rotateX: rotationRef.current.x,\r\n          rotateY: rotationRef.current.y,\r\n        });\r\n        animationFrameId = requestAnimationFrame(animate);\r\n      };\r\n  \r\n      animationFrameId = requestAnimationFrame(animate);\r\n  \r\n      return () => cancelAnimationFrame(animationFrameId);\r\n    }, [rotationSpeed, api]);\r\n  \r\n    useGesture(\r\n      {\r\n        onDrag: ({ down, movement: [mx, my] }) => {\r\n          if (down) {\r\n            rotationRef.current = {\r\n              x: -my * dragSensitivity,\r\n              y: rotationRef.current.y + mx * dragSensitivity,\r\n            };\r\n            api.start({\r\n              rotateX: -my * dragSensitivity,\r\n              rotateY: rotationRef.current.y,\r\n              immediate: true,\r\n            });\r\n          }\r\n        },\r\n      },\r\n      { target: window }\r\n    );\r\n  \r\n    return (\r\n      <ThemeProvider theme={theme}>\r\n        <GlobalStyle />\r\n        <Root>\r\n          <Scene\r\n            style={{\r\n              transform: rotateX.to((x, y) => `rotateX(${x}deg) rotateY(${y}deg)`),\r\n            }}\r\n          >\r\n            {items.map((item, index) => (\r\n              <Item\r\n                key={index}\r\n                style={{\r\n                  transform: item.transform,\r\n                }}\r\n              >\r\n                <img src={item.src} alt={item.alt} />\r\n              </Item>\r\n            ))}\r\n          </Scene>\r\n        </Root>\r\n      </ThemeProvider>\r\n    );\r\n  };\r\n"
    }
  }
};
