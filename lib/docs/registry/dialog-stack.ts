import { ComponentGroup } from "@/lib/docs/types";
import DialogStackDemo from "../components/dialog-stack";

export const dialogStackRegistry: ComponentGroup = {
  "name": "dialog-stackRegistry",
  "title": "Dialog Stack",
  "description": "A React component that provides dialog-stack functionality.",
  "category": "components",
  "components": [
    "Dialog-stackDemo"
  ],
  "installation": {
    "cliCommand": "npx shadcn@latest add \"https://zeroui.vercel.app/r/dialog-stack\"",
    "dependencies": [
      "react-dom"
    ],
    "componentPath": "components/ui/dialog-stack.tsx",
    "utilsCode": "import { ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}"
  },
  "props": [
    {
      "name": "children",
      "type": "ReactNode",
      "required": true,
      "description": "children property of type ReactNode"
    },
    {
      "name": "open",
      "type": "boolean",
      "required": false,
      "description": "open property of type boolean"
    },
    {
      "name": "onOpenChange",
      "type": "(open: boolean) => void",
      "required": false,
      "description": "onOpenChange property of type (open: boolean) => void"
    },
    {
      "name": "defaultOpen",
      "type": "boolean",
      "required": false,
      "description": "defaultOpen property of type boolean"
    },
    {
      "name": "initialStep",
      "type": "number",
      "required": false,
      "description": "initialStep property of type number"
    },
    {
      "name": "allowClickThrough",
      "type": "boolean",
      "required": false,
      "description": "allowClickThrough property of type boolean"
    },
    {
      "name": "children",
      "type": "ReactNode",
      "required": true,
      "description": "children property of type ReactNode"
    },
    {
      "name": "container",
      "type": "HTMLElement",
      "required": false,
      "description": "container property of type HTMLElement"
    }
  ],
  "variants": {
    "basic": {
      "title": "Basic Dialog-stack",
      "description": "A basic implementation of the Dialog-stack component.",
      "component": DialogStackDemo,
      "image": "/images/components/dialog-stack-basic.png",
      "fallbackImage": "/placeholder.svg?height=300&width=400&text=Basic%20Dialog-stack",
      "code": "\"use client\";\nimport { Dialog-stack } from \"../ui/dialog-stack\";\n\nexport const Dialog-stackDemo = () => {\n  return (\n    <div className=\"w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-900 p-12 rounded-xl\">\n      <Dialog-stack>\n        Demo Content\n      </Dialog-stack>\n    </div>\n  );\n};\n\nexport default Dialog-stackDemo;",
      "manualCode": "'use client';\r\n\r\nimport React, { \r\n  createContext, \r\n  useContext, \r\n  useState, \r\n  useCallback, \r\n  useEffect,\r\n  forwardRef,\r\n  type ReactNode,\r\n  type HTMLAttributes,\r\n  type ButtonHTMLAttributes,\r\n  type MouseEvent,\r\n} from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\n// Utility function for class names\r\nconst cx = (...classes: (string | undefined | null | boolean)[]): string => {\r\n  return classes.filter(Boolean).join(' ');\r\n};\r\n\r\n// Types\r\ninterface DialogStackContextValue {\r\n  isOpen: boolean;\r\n  activeStep: number;\r\n  totalSteps: number;\r\n  canGoNext: boolean;\r\n  canGoPrevious: boolean;\r\n  openDialog: () => void;\r\n  closeDialog: () => void;\r\n  goToStep: (step: number) => void;\r\n  nextStep: () => void;\r\n  previousStep: () => void;\r\n  registerStep: () => number;\r\n  unregisterStep: (id: number) => void;\r\n}\r\n\r\ninterface DialogStackProps {\r\n  children: ReactNode;\r\n  open?: boolean;\r\n  onOpenChange?: (open: boolean) => void;\r\n  defaultOpen?: boolean;\r\n  initialStep?: number;\r\n  allowClickThrough?: boolean;\r\n}\r\n\r\ninterface DialogTriggerProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n  asChild?: boolean;\r\n}\r\n\r\ninterface DialogOverlayProps extends HTMLAttributes<HTMLDivElement> {\r\n  blur?: boolean;\r\n}\r\n\r\ninterface DialogPortalProps {\r\n  children: ReactNode;\r\n  container?: HTMLElement;\r\n}\r\n\r\ninterface DialogContentProps extends HTMLAttributes<HTMLDivElement> {\r\n  step: number;\r\n  offset?: number;\r\n  scale?: boolean;\r\n}\r\n\r\ninterface DialogHeaderProps extends HTMLAttributes<HTMLDivElement> {}\r\ninterface DialogTitleProps extends HTMLAttributes<HTMLHeadingElement> {}\r\ninterface DialogDescriptionProps extends HTMLAttributes<HTMLParagraphElement> {}\r\ninterface DialogFooterProps extends HTMLAttributes<HTMLDivElement> {}\r\n\r\ninterface DialogActionProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: 'primary' | 'secondary' | 'ghost';\r\n  size?: 'sm' | 'md' | 'lg';\r\n}\r\n\r\ninterface DialogNavigationProps extends ButtonHTMLAttributes<HTMLButtonElement> {\r\n  variant?: 'primary' | 'secondary';\r\n}\r\n\r\n// Context\r\nconst DialogStackContext = createContext<DialogStackContextValue | null>(null);\r\n\r\nconst useDialogStack = (): DialogStackContextValue => {\r\n  const context = useContext(DialogStackContext);\r\n  if (!context) {\r\n    throw new Error('Dialog components must be used within DialogStack');\r\n  }\r\n  return context;\r\n};\r\n\r\n// Main DialogStack Component\r\nexport const DialogStack: React.FC<DialogStackProps> = ({\r\n  children,\r\n  open,\r\n  onOpenChange,\r\n  defaultOpen = false,\r\n  initialStep = 0,\r\n  allowClickThrough = false,\r\n}) => {\r\n  const [isOpen, setIsOpen] = useState(defaultOpen);\r\n  const [activeStep, setActiveStep] = useState(initialStep);\r\n  const [stepRegistry, setStepRegistry] = useState<Set<number>>(new Set());\r\n  const [stepCounter, setStepCounter] = useState(0);\r\n\r\n  const totalSteps = stepRegistry.size;\r\n  const canGoNext = activeStep < totalSteps - 1;\r\n  const canGoPrevious = activeStep > 0;\r\n\r\n  // Handle controlled state\r\n  const finalIsOpen = open !== undefined ? open : isOpen;\r\n\r\n  const openDialog = useCallback(() => {\r\n    if (open === undefined) {\r\n      setIsOpen(true);\r\n    }\r\n    onOpenChange?.(true);\r\n  }, [open, onOpenChange]);\r\n\r\n  const closeDialog = useCallback(() => {\r\n    if (open === undefined) {\r\n      setIsOpen(false);\r\n    }\r\n    onOpenChange?.(false);\r\n  }, [open, onOpenChange]);\r\n\r\n  const goToStep = useCallback((step: number) => {\r\n    if (step >= 0 && step < totalSteps) {\r\n      setActiveStep(step);\r\n    }\r\n  }, [totalSteps]);\r\n\r\n  const nextStep = useCallback(() => {\r\n    if (canGoNext) {\r\n      setActiveStep(prev => prev + 1);\r\n    }\r\n  }, [canGoNext]);\r\n\r\n  const previousStep = useCallback(() => {\r\n    if (canGoPrevious) {\r\n      setActiveStep(prev => prev - 1);\r\n    }\r\n  }, [canGoPrevious]);\r\n\r\n  const registerStep = useCallback(() => {\r\n    const id = stepCounter;\r\n    setStepCounter(prev => prev + 1);\r\n    setStepRegistry(prev => new Set([...prev, id]));\r\n    return id;\r\n  }, [stepCounter]);\r\n\r\n  const unregisterStep = useCallback((id: number) => {\r\n    setStepRegistry(prev => {\r\n      const newSet = new Set(prev);\r\n      newSet.delete(id);\r\n      return newSet;\r\n    });\r\n  }, []);\r\n\r\n  // Reset active step when dialog closes\r\n  useEffect(() => {\r\n    if (!finalIsOpen && initialStep !== activeStep) {\r\n      setActiveStep(initialStep);\r\n    }\r\n  }, [finalIsOpen, initialStep, activeStep]);\r\n\r\n  const contextValue: DialogStackContextValue = {\r\n    isOpen: finalIsOpen,\r\n    activeStep,\r\n    totalSteps,\r\n    canGoNext,\r\n    canGoPrevious,\r\n    openDialog,\r\n    closeDialog,\r\n    goToStep,\r\n    nextStep,\r\n    previousStep,\r\n    registerStep,\r\n    unregisterStep,\r\n  };\r\n\r\n  return (\r\n    <DialogStackContext.Provider value={contextValue}>\r\n      {children}\r\n    </DialogStackContext.Provider>\r\n  );\r\n};\r\n\r\n// Dialog Trigger\r\nexport const DialogTrigger = forwardRef<HTMLButtonElement, DialogTriggerProps>(\r\n  ({ children, onClick, className, asChild, ...props }, ref) => {\r\n    const { openDialog } = useDialogStack();\r\n\r\n    const handleClick = (e: MouseEvent<HTMLButtonElement>) => {\r\n      openDialog();\r\n      onClick?.(e);\r\n    };\r\n\r\n    if (asChild) {\r\n      return React.cloneElement(children as React.ReactElement<any>, {\r\n        onClick: handleClick,\r\n        ref,\r\n        ...props,\r\n      });\r\n    }\r\n\r\n    return (\r\n      <button\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        className={cx(\r\n          'inline-flex items-center justify-center rounded-lg font-medium transition-all',\r\n          'focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2',\r\n          'disabled:pointer-events-none disabled:opacity-50',\r\n          'bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800',\r\n          'px-4 py-2 text-sm',\r\n          className\r\n        )}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </button>\r\n    );\r\n  }\r\n);\r\nDialogTrigger.displayName = 'DialogTrigger';\r\n\r\n// Dialog Portal\r\nexport const DialogPortal: React.FC<DialogPortalProps> = ({ \r\n  children, \r\n  container \r\n}) => {\r\n  const [mounted, setMounted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setMounted(true);\r\n  }, []);\r\n\r\n  if (!mounted) return null;\r\n\r\n  return createPortal(\r\n    children, \r\n    container || document.body\r\n  );\r\n};\r\n\r\n// Dialog Overlay\r\nexport const DialogOverlay = forwardRef<HTMLDivElement, DialogOverlayProps>(\r\n  ({ className, onClick, blur = true, ...props }, ref) => {\r\n    const { isOpen, closeDialog } = useDialogStack();\r\n\r\n    const handleClick = (e: MouseEvent<HTMLDivElement>) => {\r\n      if (e.target === e.currentTarget) {\r\n        closeDialog();\r\n      }\r\n      onClick?.(e);\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        className={cx(\r\n          'fixed inset-0 z-50 flex items-center justify-center p-4',\r\n          'bg-black/60 backdrop-blur-sm',\r\n          'data-[state=closed]:animate-out data-[state=open]:animate-in',\r\n          'data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0',\r\n          blur && 'backdrop-blur-sm',\r\n          className\r\n        )}\r\n        data-state={isOpen ? 'open' : 'closed'}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n);\r\nDialogOverlay.displayName = 'DialogOverlay';\r\n\r\n// Dialog Content\r\nexport const DialogContent = forwardRef<HTMLDivElement, DialogContentProps>(\r\n  ({ \r\n    children, \r\n    className, \r\n    step, \r\n    offset = 8, \r\n    scale = true, \r\n    onClick, \r\n    ...props \r\n  }, ref) => {\r\n    const { isOpen, activeStep, goToStep } = useDialogStack();\r\n    const [stepId] = useState(() => step);\r\n\r\n    const isActive = activeStep === step;\r\n    const isVisible = activeStep >= step;\r\n    const distanceFromActive = step - activeStep;\r\n\r\n    const handleClick = (e: MouseEvent<HTMLDivElement>) => {\r\n      // Allow clicking on previous steps to go back\r\n      if (step < activeStep) {\r\n        goToStep(step);\r\n      }\r\n      onClick?.(e);\r\n    };\r\n\r\n    if (!isOpen || !isVisible) return null;\r\n\r\n    const translateY = distanceFromActive * offset;\r\n    const scaleValue = scale ? Math.max(0.95, 1 - Math.abs(distanceFromActive) * 0.05) : 1;\r\n    const opacity = distanceFromActive === 0 ? 1 : 0.7;\r\n    const zIndex = 100 - Math.abs(distanceFromActive);\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        className={cx(\r\n          'relative w-full max-w-md rounded-xl border bg-white p-6 shadow-2xl',\r\n          'transform transition-all duration-300 ease-out',\r\n          'dark:bg-gray-900 dark:border-gray-700',\r\n          step < activeStep && 'cursor-pointer hover:shadow-xl',\r\n          className\r\n        )}\r\n        style={{\r\n          transform: `translateY(${translateY}px) scale(${scaleValue})`,\r\n          opacity,\r\n          zIndex,\r\n          position: distanceFromActive === 0 ? 'relative' : 'absolute',\r\n          top: 0,\r\n          left: '50%',\r\n          marginLeft: distanceFromActive === 0 ? '0' : '-50%',\r\n          width: distanceFromActive === 0 ? '100%' : 'calc(100% - 20px)',\r\n        }}\r\n        {...props}\r\n      >\r\n        <div\r\n          className={cx(\r\n            'transition-opacity duration-200',\r\n            !isActive && 'pointer-events-none opacity-40'\r\n          )}\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\nDialogContent.displayName = 'DialogContent';\r\n\r\n// Dialog Header\r\nexport const DialogHeader = forwardRef<HTMLDivElement, DialogHeaderProps>(\r\n  ({ className, ...props }, ref) => (\r\n    <div\r\n      ref={ref}\r\n      className={cx('flex flex-col space-y-2 mb-4', className)}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nDialogHeader.displayName = 'DialogHeader';\r\n\r\n// Dialog Title\r\nexport const DialogTitle = forwardRef<HTMLHeadingElement, DialogTitleProps>(\r\n  ({ className, ...props }, ref) => (\r\n    <h2\r\n      ref={ref}\r\n      className={cx(\r\n        'text-xl font-semibold leading-tight text-gray-900 dark:text-gray-100',\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nDialogTitle.displayName = 'DialogTitle';\r\n\r\n// Dialog Description\r\nexport const DialogDescription = forwardRef<HTMLParagraphElement, DialogDescriptionProps>(\r\n  ({ className, ...props }, ref) => (\r\n    <p\r\n      ref={ref}\r\n      className={cx(\r\n        'text-sm text-gray-600 dark:text-gray-400',\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nDialogDescription.displayName = 'DialogDescription';\r\n\r\n// Dialog Footer\r\nexport const DialogFooter = forwardRef<HTMLDivElement, DialogFooterProps>(\r\n  ({ className, ...props }, ref) => (\r\n    <div\r\n      ref={ref}\r\n      className={cx(\r\n        'flex items-center justify-end gap-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700',\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n);\r\nDialogFooter.displayName = 'DialogFooter';\r\n\r\n// Dialog Actions (Generic Button)\r\nexport const DialogAction = forwardRef<HTMLButtonElement, DialogActionProps>(\r\n  ({ \r\n    children, \r\n    className, \r\n    variant = 'primary', \r\n    size = 'md', \r\n    ...props \r\n  }, ref) => {\r\n    const baseClasses = cx(\r\n      'inline-flex items-center justify-center rounded-lg font-medium transition-all',\r\n      'focus:outline-none focus:ring-2 focus:ring-offset-2',\r\n      'disabled:pointer-events-none disabled:opacity-50'\r\n    );\r\n\r\n    const variantClasses = {\r\n      primary: 'bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500',\r\n      secondary: 'bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500 dark:bg-gray-700 dark:text-gray-100',\r\n      ghost: 'text-gray-600 hover:bg-gray-100 focus:ring-gray-500 dark:text-gray-400 dark:hover:bg-gray-800',\r\n    };\r\n\r\n    const sizeClasses = {\r\n      sm: 'px-3 py-1.5 text-xs',\r\n      md: 'px-4 py-2 text-sm',\r\n      lg: 'px-6 py-3 text-base',\r\n    };\r\n\r\n    return (\r\n      <button\r\n        ref={ref}\r\n        className={cx(\r\n          baseClasses,\r\n          variantClasses[variant],\r\n          sizeClasses[size],\r\n          className\r\n        )}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </button>\r\n    );\r\n  }\r\n);\r\nDialogAction.displayName = 'DialogAction';\r\n\r\n// Dialog Navigation - Next\r\nexport const DialogNext = forwardRef<HTMLButtonElement, DialogNavigationProps>(\r\n  ({ children, onClick, variant = 'primary', ...props }, ref) => {\r\n    const { nextStep, canGoNext } = useDialogStack();\r\n\r\n    const handleClick = (e: MouseEvent<HTMLButtonElement>) => {\r\n      nextStep();\r\n      onClick?.(e);\r\n    };\r\n\r\n    return (\r\n      <DialogAction\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        disabled={!canGoNext}\r\n        variant={variant}\r\n        {...props}\r\n      >\r\n        {children || 'Next'}\r\n      </DialogAction>\r\n    );\r\n  }\r\n);\r\nDialogNext.displayName = 'DialogNext';\r\n\r\n// Dialog Navigation - Previous\r\nexport const DialogPrevious = forwardRef<HTMLButtonElement, DialogNavigationProps>(\r\n  ({ children, onClick, variant = 'secondary', ...props }, ref) => {\r\n    const { previousStep, canGoPrevious } = useDialogStack();\r\n\r\n    const handleClick = (e: MouseEvent<HTMLButtonElement>) => {\r\n      previousStep();\r\n      onClick?.(e);\r\n    };\r\n\r\n    return (\r\n      <DialogAction\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        disabled={!canGoPrevious}\r\n        variant={variant}\r\n        {...props}\r\n      >\r\n        {children || 'Previous'}\r\n      </DialogAction>\r\n    );\r\n  }\r\n);\r\nDialogPrevious.displayName = 'DialogPrevious';\r\n\r\n// Dialog Close\r\nexport const DialogClose = forwardRef<HTMLButtonElement, DialogActionProps>(\r\n  ({ children, onClick, variant = 'ghost', ...props }, ref) => {\r\n    const { closeDialog } = useDialogStack();\r\n\r\n    const handleClick = (e: MouseEvent<HTMLButtonElement>) => {\r\n      closeDialog();\r\n      onClick?.(e);\r\n    };\r\n\r\n    return (\r\n      <DialogAction\r\n        ref={ref}\r\n        onClick={handleClick}\r\n        variant={variant}\r\n        {...props}\r\n      >\r\n        {children || 'Close'}\r\n      </DialogAction>\r\n    );\r\n  }\r\n);\r\nDialogClose.displayName = 'DialogClose';\r\n\r\n// Export all components\r\nexport {\r\n  DialogStack as Root,\r\n  DialogTrigger as Trigger,\r\n  DialogPortal as Portal,\r\n  DialogOverlay as Overlay,\r\n  DialogContent as Content,\r\n  DialogHeader as Header,\r\n  DialogTitle as Title,\r\n  DialogDescription as Description,\r\n  DialogFooter as Footer,\r\n  DialogAction as Action,\r\n  DialogNext as Next,\r\n  DialogPrevious as Previous,\r\n  DialogClose as Close,\r\n};\r\n"
    }
  }
};
